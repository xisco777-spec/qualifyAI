{
  "name": "QualifAI",
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.from.id }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        720,
        320
      ],
      "id": "0804b7d2-f6ce-41b2-9c9e-114222c36180",
      "name": "Window Buffer Memory"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b5aebc58-fe03-41db-8435-4883ff17a016",
              "leftValue": "={{ $json.output }}",
              "rightValue": "YES",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2040,
        560
      ],
      "id": "a74f6029-c6d0-445c-9fe5-f524dfe9f8b9",
      "name": "If"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Das ist der generierte Output aus dem vorherigen GesprÃ¤chsverlauf: {{ $('ChatAI').item.json.output }}\n\nVerwende nun die bisherige Zusammenfassung aus dem Tool \"prevSum\" um deine neue Zusammenfassung zu erstellen.",
        "options": {
          "systemMessage": "=Aufgabe:\nDu bist ein hochentwickelter AI-Agent, spezialisiert auf das prÃ¤zise und detaillierte Zusammenfassen von Informationen. Deine Hauptaufgabe ist es, einen neuen generierten Output mit einer bereits bestehenden Zusammenfassung zu vergleichen und eine verbesserte, erweiterte Version zu erstellen.\n\nVorgehensweise:\n\nEingabe:\n\nDu erhÃ¤ltst eine neue generierte Antwort (Neue Erkenntnisse).\nBenutze eine bisherige Zusammenfassung (Bisherige Zusammenfassung in Google Sheets Ã¼ber das Sheets Tool \"prevSum\").\n\nAnalyse:\n\nIdentifiziere die Kernpunkte der Neuen Erkenntnisse.\nVergleiche diese mit der Bisherigen Zusammenfassung, um Redundanzen zu vermeiden.\nBestimme, welche neuen Informationen hinzugefÃ¼gt werden mÃ¼ssen.\n\nErstellung der kombinierten Zusammenfassung:\n\nIntegriere die neuen Informationen nahtlos in die bestehende Zusammenfassung.\nAchte darauf, dass die Zusammenfassung kohÃ¤rent bleibt und keinen Informationsverlust erleidet.\nFasse prÃ¤zise, aber detailliert zusammen, indem du relevante Details und ZusammenhÃ¤nge einfÃ¼gst.\n\nOutput:\n\nSchreibe den Output in Englisch!\nGib die optimierte Zusammenfassung aus, die den bisherigen GesprÃ¤chsverlauf immer prÃ¤ziser und detaillierter kombiniert.\nFormatierung der Zusammenfassung:\nVerwende klare, gut strukturierte AbsÃ¤tze.\nFalls sinnvoll, nutze Stichpunkte zur besseren Lesbarkeit.\nFasse prÃ¤gnant zusammen, ohne essenzielle Informationen zu verlieren.\nVermeide Wiederholungen, optimiere den sprachlichen Ausdruck."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1440,
        100
      ],
      "id": "c5d3d0f7-d6f7-475c-9e9e-23303fc76cff",
      "name": "SummAI",
      "retryOnFail": true
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ",
          "mode": "list",
          "cachedResultName": "SalesAgentTest",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name": "={{ $('Airtable').item.json.Vorname }} {{ $('Switch').item.json.Nachname }}",
            "Zusammenfassung": "={{ $json.output }}"
          },
          "matchingColumns": [
            "Name"
          ],
          "schema": [
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Zusammenfassung",
              "displayName": "Zusammenfassung",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1840,
        280
      ],
      "id": "4dc22ddf-c3c7-428c-9c0b-c939a28350c5",
      "name": "Zusammenfassung",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "o6VgHADWIo2hRlUi",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.2,
      "position": [
        600,
        320
      ],
      "id": "90a1d8d6-0274-4069-8fd4-8bd05eb16e23",
      "name": "Anthropic Chat Model",
      "credentials": {
        "anthropicApi": {
          "id": "wGqwxdmmAz7xc4HH",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.2,
      "position": [
        1620,
        760
      ],
      "id": "16b105ba-59d5-4a9b-ae82-534a30bd4229",
      "name": "Anthropic Chat Model2",
      "credentials": {
        "anthropicApi": {
          "id": "wGqwxdmmAz7xc4HH",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "=You are an AI-assisted chat agent tasked with qualifying potential customers for life coaching services using the BANT (Budget, Authority, Need, Timeline) model. Your goal is to efficiently determine if a customer is qualified through a WhatsApp conversation.\n\nHere is the available customer information:\n\n<customer_info>\nVorname: {{ $('Airtable').item.json.Vorname }}    \nNachname: {{ $('Switch').item.json.Nachname }}    \nIndustrie: {{ $('Switch').item.json.Branche }}    \nUnternehmen: {{ $('Switch').item.json.Firma }}    \nWebsite: {{ $('Switch').item.json.Website }}    \nJahresumsatz (in â‚¬): {{ $('Switch').item.json.Jahresumsatz }}    \nE-Mail: {{ $('Switch').item.json['E-Mail'] }} \n\nThe customer's latest message is:\n\n<customer_message>\n{{ $json.text }}\n</customer_message>\n\nInstructions:\n\n\n\n1. Use the Google Sheets Tool \"prevValidation\" to check which BANT questions have already been answered and which are still missing.\n\n2. Use the Google Sheets Tool \"prevSummary\" to review the conversation history.\n(If its the first User message (empty Summary and Validation), start with a first message to recieve the BANT-Information)\n\n3. Based on the missing BANT information, formulate 1-2 targeted questions to ask the customer. Focus on one BANT category at a time.\n\n4. Craft a concise, friendly, and professional WhatsApp message containing your questions.\n\n5. If all BANT information has been collected, or if the customer expresses complaints or feedback, thank them and inform them that you'll pass their message to a human representative.\n\nImportant Rules:\n- Write the Telegram-Message in english language\n- you don't have to greet the customer in every message\n- Keep messages short and suitable for Telegram.\n- Do not explain your thought process or actions in the message.\n- Maintain a friendly and professional tone.\n- If you encounter complaints or feedback, thank the customer and inform them that you'll pass it to a human representative.\n\nConduct your BANT analysis inside <bant_analysis> tags before crafting the final WhatsApp message. Your output should only contain the WhatsApp message, enclosed in <whatsapp_message> tags.\n\nExample output structure:\n\n<bant_analysis>\n1. Review customer information:\n   - [Note any relevant details from customer_info]\n\n2. Analyze Budget:\n   - [Note what's known/unknown about budget]\n   - [Formulate question if needed]\n\n3. Analyze Authority:\n   - [Note what's known/unknown about authority]\n   - [Formulate question if needed]\n\n4. Analyze Need:\n   - [Note what's known/unknown about need]\n   - [Formulate question if needed]\n\n5. Analyze Timeline:\n   - [Note what's known/unknown about timeline]\n   - [Formulate question if needed]\n\n6. Formulate final questions:\n   - [List 1-2 most important questions based on analysis]\n</bant_analysis>\n\n<whatsapp_message>\n\n[Your 1-2 targeted questions here]\n\n\n</whatsapp_message>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        700,
        100
      ],
      "id": "74046f7b-01df-41d5-af20-c221e216a3bc",
      "name": "ChatAI",
      "alwaysOutputData": false,
      "retryOnFail": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Dies ist die bisherige Zusammenfassung auf Grundlage derer validiert werden soll:   {{ $json.Zusammenfassung }}",
        "options": {
          "systemMessage": "=Aufgabe:\nDu bist ein spezialisierter AI-Agent zur Validierung eines GesprÃ¤chs nach dem BANT-Modell (Budget, Authority, Need, Timeline). Deine Aufgabe ist es zu prÃ¼fen, ob das GesprÃ¤ch beendet werden kann, indem du Ã¼berprÃ¼fst, ob alle erforderlichen Informationen vollstÃ¤ndig in der Zusammenfassung enthalten sind.\n\nVorgehensweise:\n\nEingabe:\n\nEine vollstÃ¤ndige aktuelle Zusammenfassung des GesprÃ¤chs.\n\nValidierung nach dem BANT-Modell:\n\nBudget: Wurde das verfÃ¼gbare Budget des Kunden genannt oder ein Hinweis darauf gegeben?\nAuthority (Entscheidungsbefugnis): Wurde geklÃ¤rt, ob der Kunde die Kaufentscheidung treffen kann oder wer sie trifft?\nNeed (Bedarf): Wurde der spezifische Bedarf des Kunden ermittelt?\nTimeline (Zeitplan): Wurde ein Zeitrahmen fÃ¼r die Umsetzung oder Kaufentscheidung erfragt?\n\nAbgleich mit den gestellten Fragen:\n\nSind alle Fragen aus der ursprÃ¼nglichen Liste in der Zusammenfassung beantwortet?\nFalls eine oder mehrere der erforderlichen Informationen fehlen, ist das GesprÃ¤ch noch nicht abgeschlossen.\n\nAusgabe:\nOutput soll auf Englisch sein!\nErstelle eine Kurze Ãœbersicht Ã¼ber jedes BANT-Kriterium und ob und inwiefern diese schon beatnwortet wurden\nYES â†’ Wenn alle vier BANT-Kriterien erfÃ¼llt und alle relevanten Fragen beantwortet sind.\nNO â†’ Falls noch Informationen fehlen, die notwendig sind, um das GesprÃ¤ch abzuschlieÃŸen.\n\nWichtig:\nAntworte mit YES nur wenn alle Kriterien erfÃ¼llt sind! Sollten nicht alle Kriterien erfÃ¼llt sein darf sich kein \"YES\" in dem Output befinden.\n\nWenn zu jedem BANT-Kriterium einige Informationen vorliegen, ist das GesprÃ¤ch als validiert zu betrachten und mit YES zu markieren. Es muss nicht zu detailliert nachgefragt werden, da dies dann von einem Kollegen in einem zukÃ¼nftigen persÃ¶nlichem GesprÃ¤ch erledigt wird.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1660,
        560
      ],
      "id": "38c398be-a164-4992-8324-60cbde15ea31",
      "name": "ValidateAI",
      "retryOnFail": true
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ",
          "mode": "list",
          "cachedResultName": "SalesAgentTest",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1034309098,
          "mode": "list",
          "cachedResultName": "Val",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit#gid=1034309098"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name": "={{ $('Airtable').item.json.Vorname }} {{ $('Switch').item.json.Nachname }}",
            "Validate Info": "={{ $json.output }}"
          },
          "matchingColumns": [
            "Name"
          ],
          "schema": [
            {
              "id": "Name",
              "displayName": "Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Validate Info",
              "displayName": "Validate Info",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        2040,
        900
      ],
      "id": "319a60d9-d6a1-4b59-9a66-6aa128d3070c",
      "name": "ValidateInfo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "o6VgHADWIo2hRlUi",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ",
          "mode": "list",
          "cachedResultName": "SalesAgentTest",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1034309098,
          "mode": "list",
          "cachedResultName": "Val",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit#gid=1034309098"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Name",
              "lookupValue": "={{ $('Airtable').item.json.Vorname }} {{ $('Switch').item.json.Nachname }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        840,
        320
      ],
      "id": "efd50aee-09f6-4510-a419-ecac3e346015",
      "name": "prevValidation",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "o6VgHADWIo2hRlUi",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ",
          "mode": "list",
          "cachedResultName": "SalesAgentTest",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Name",
              "lookupValue": "={{ $('Airtable').item.json.Vorname }} {{ $('Switch').item.json.Nachname }}"
            }
          ]
        },
        "combineFilters": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        1580,
        300
      ],
      "id": "05a5c990-7537-4f72-a479-0faf3030b0a4",
      "name": "prevSum",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "o6VgHADWIo2hRlUi",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.text }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "id": "1f940762-b876-481a-b23e-a0d45f70fd19"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "222fd044-ef24-4303-ab62-c9499cfe5e85",
                    "leftValue": "={{ $('Telegram Trigger').item.json.message.voice }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -60,
        120
      ],
      "id": "e77acfe4-c527-4574-8a96-62c51cd20696",
      "name": "Switch"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        380,
        220
      ],
      "id": "081c8a0d-6658-4104-b843-2b5a0b564d1f",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "6V8D9KpngJsguB5N",
          "name": "OpenAi account 3"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a4764bbb-af4d-4764-a2f3-a1e3c21e6b4b",
              "name": "text",
              "value": "={{ $('Telegram Trigger').item.json.message.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        280,
        0
      ],
      "id": "94006878-c1c7-4280-8d0c-8c166eece83f",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "model": "claude-3-5-haiku-20241022",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.2,
      "position": [
        1420,
        300
      ],
      "id": "eff658a9-c964-4ece-ac9c-7f5ce8983f30",
      "name": "Anthropic Chat Model1",
      "credentials": {
        "anthropicApi": {
          "id": "wGqwxdmmAz7xc4HH",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "29d6ab64-18fc-40b5-9be9-de3c90e187d2",
              "leftValue": "={{ $json.Status }}",
              "rightValue": "Validated",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -280,
        120
      ],
      "id": "d0eefe0a-b2e8-4e17-b3ad-735e4b963bfa",
      "name": "isValidated"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ",
          "mode": "list",
          "cachedResultName": "SalesAgentTest",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sum",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10eHFS5akLGvXWsQxNh9JrL9tuts3ghOw17lxwIliSIQ/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Name",
              "lookupValue": "{{ $('Airtable').item.json.Vorname }} {{ $('Switch').item.json.Nachname }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        960,
        320
      ],
      "id": "8c1c1c4c-4098-4d7e-8b7d-accceded432b",
      "name": "prevSummery",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "o6VgHADWIo2hRlUi",
          "name": "Google Sheets account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst extractedMessages = items.map((item) => {\n  const messageStart =\n    item?.json?.output.indexOf(\"<whatsapp_message>\") +\n    \"<whatsapp_message>\".length;\n  const messageEnd = item?.json?.output.indexOf(\"</whatsapp_message>\");\n  const message = item?.json?.output.substring(messageStart, messageEnd);\n  return { message };\n});\nreturn extractedMessages;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1140,
        100
      ],
      "id": "dba1f6d8-edf4-4389-96df-b6287e26c889",
      "name": "Code"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -1600,
        100
      ],
      "id": "0987bf2a-a3a8-4534-8893-78e7050ff2bc",
      "name": "Telegram Trigger",
      "webhookId": "8bd8b941-bb99-4b2f-8a1b-0b5ed2c8e8e2",
      "credentials": {
        "telegramApi": {
          "id": "lG4aK4bv3oge74l1",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Telegram Trigger').item.json.message.voice.file_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        160,
        220
      ],
      "id": "aa7d4868-6d0a-481a-a1d2-abe49728149c",
      "name": "Telegram",
      "webhookId": "1f4aae7e-59c1-4169-962b-124d7ddd564b",
      "credentials": {
        "telegramApi": {
          "id": "lG4aK4bv3oge74l1",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appEeNZx6kc1nGIIT",
          "mode": "list",
          "cachedResultName": "PA",
          "cachedResultUrl": "https://airtable.com/appEeNZx6kc1nGIIT"
        },
        "table": {
          "__rl": true,
          "value": "tblwsGOyqNhko2X3u",
          "mode": "list",
          "cachedResultName": "QualifAI",
          "cachedResultUrl": "https://airtable.com/appEeNZx6kc1nGIIT/tblwsGOyqNhko2X3u"
        },
        "filterByFormula": "={Chat-Id}= {{ $json.message.from.id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -940,
        120
      ],
      "id": "f34b52e1-3437-41b7-b22f-534712da8224",
      "name": "Airtable",
      "credentials": {
        "airtableTokenApi": {
          "id": "MUVJrUZjgYRt8uxV",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appEeNZx6kc1nGIIT",
          "mode": "list",
          "cachedResultName": "PA",
          "cachedResultUrl": "https://airtable.com/appEeNZx6kc1nGIIT"
        },
        "table": {
          "__rl": true,
          "value": "tblwsGOyqNhko2X3u",
          "mode": "list",
          "cachedResultName": "QualifAI",
          "cachedResultUrl": "https://airtable.com/appEeNZx6kc1nGIIT/tblwsGOyqNhko2X3u"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Status": "Validated",
            "Chat-Id": "={{ $('isValidated').item.json['Chat-Id'] }}"
          },
          "matchingColumns": [
            "Chat-Id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Nachname",
              "displayName": "Nachname",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Vorname",
              "displayName": "Vorname",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Firma",
              "displayName": "Firma",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "E-Mail",
              "displayName": "E-Mail",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Tel.",
              "displayName": "Tel.",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Branche",
              "displayName": "Branche",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Website",
              "displayName": "Website",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Jahresumsatz",
              "displayName": "Jahresumsatz",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Chat-Id",
              "displayName": "Chat-Id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Validated",
                  "value": "Validated"
                },
                {
                  "name": "Un-Validated",
                  "value": "Un-Validated"
                }
              ],
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        2260,
        460
      ],
      "id": "61bddf8d-8be5-4f9c-a64b-63f9bf32d7bc",
      "name": "Airtable1",
      "credentials": {
        "airtableTokenApi": {
          "id": "MUVJrUZjgYRt8uxV",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "={{ $('Code').item.json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2260,
        660
      ],
      "id": "34c90d32-11a4-4973-83b7-71bb79943a5b",
      "name": "Telegram1",
      "webhookId": "7dbb90a4-1d0b-4556-abf1-8dc9a846b484",
      "credentials": {
        "telegramApi": {
          "id": "lG4aK4bv3oge74l1",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "=Thank you for answering my questions, {{ $('Airtable').item.json.Vorname }}.\n\nWeâ€™ll get back to you shortly with some suggested times for a personal consultation.\n\nWishing you all the best and a great day!",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2480,
        460
      ],
      "id": "d128d48b-437c-4058-b218-6f2084cb4185",
      "name": "Telegram2",
      "webhookId": "64bb7ac8-4247-485f-aee0-d0eeb1e701cc",
      "credentials": {
        "telegramApi": {
          "id": "lG4aK4bv3oge74l1",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bf78e38a-4e42-4393-ba39-9e7a014638ba",
              "leftValue": "={{ $json.message.entities[0].type }}",
              "rightValue": "bot_command",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1340,
        100
      ],
      "id": "517cabb5-6468-407c-9a77-119f0b077c3a",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appEeNZx6kc1nGIIT",
          "mode": "list",
          "cachedResultName": "PA",
          "cachedResultUrl": "https://airtable.com/appEeNZx6kc1nGIIT"
        },
        "table": {
          "__rl": true,
          "value": "tblwsGOyqNhko2X3u",
          "mode": "list",
          "cachedResultName": "QualifAI",
          "cachedResultUrl": "https://airtable.com/appEeNZx6kc1nGIIT/tblwsGOyqNhko2X3u"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Telegram-Username": "={{ $('If1').item.json.message.from.username }}",
            "Chat-Id": "={{ $json.message.from.id }}",
            "Status": "Un-Validated"
          },
          "matchingColumns": [
            "Telegram-Username"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Nachname",
              "displayName": "Nachname",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Vorname",
              "displayName": "Vorname",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Firma",
              "displayName": "Firma",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "E-Mail",
              "displayName": "E-Mail",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Tel.",
              "displayName": "Tel.",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Branche",
              "displayName": "Branche",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Website",
              "displayName": "Website",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Jahresumsatz",
              "displayName": "Jahresumsatz",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Telegram-Username",
              "displayName": "Telegram-Username",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Chat-Id",
              "displayName": "Chat-Id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Validated",
                  "value": "Validated"
                },
                {
                  "name": "Un-Validated",
                  "value": "Un-Validated"
                }
              ],
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "typecast": true
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -940,
        -100
      ],
      "id": "dd85d947-24fd-402a-bb5f-f89444fea55e",
      "name": "Airtable2",
      "credentials": {
        "airtableTokenApi": {
          "id": "MUVJrUZjgYRt8uxV",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ba231b89-a7c2-47cd-859b-f89c16db8416",
              "name": "message.from.id",
              "value": "={{ $json.message.from.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1140,
        -100
      ],
      "id": "64be707b-9265-4f1b-9645-388f7678eb7d",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "chatId": "={{ $json.fields['Chat-Id'] }}",
        "text": "=Hey there! ðŸ‘‹\nThanks for your interest and trust â€“ great to have you here!\n\nIâ€™m QualifAI, your personal assistant.\nIn the next few minutes, Iâ€™ll ask you a few short questions to better understand your needs and goals.\n\nYou can simply reply to each question with a message or a voice note, right here in the chat â€“ whatever works best for you.\nðŸ‘‰ Please make sure to send only one message or voice note at a time, so I can respond properly.\n\nWhen you're ready to begin, just reply to this message in any way â€“ and weâ€™ll get started. ðŸ™Œ",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -720,
        -100
      ],
      "id": "5edf25b7-473a-41fc-b90d-1ad81bd7b1c4",
      "name": "Telegram3",
      "webhookId": "c2aed5eb-1eb6-4007-8e4b-da3be4a665d2",
      "credentials": {
        "telegramApi": {
          "id": "lG4aK4bv3oge74l1",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "ChatAI",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Airtable1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SummAI": {
      "main": [
        [
          {
            "node": "Zusammenfassung",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Zusammenfassung": {
      "main": [
        [
          {
            "node": "ValidateAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "ChatAI",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "ValidateAI",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ChatAI": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ValidateAI": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          },
          {
            "node": "ValidateInfo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prevValidation": {
      "ai_tool": [
        [
          {
            "node": "ChatAI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "prevSum": {
      "ai_tool": [
        [
          {
            "node": "SummAI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "ChatAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "ChatAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "SummAI",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "isValidated": {
      "main": [
        [],
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prevSummery": {
      "ai_tool": [
        [
          {
            "node": "ChatAI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "SummAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable": {
      "main": [
        [
          {
            "node": "isValidated",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable1": {
      "main": [
        [
          {
            "node": "Telegram2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Airtable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Airtable2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable2": {
      "main": [
        [
          {
            "node": "Telegram3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3cb59899-6d63-48f5-8d35-d14ad02a5bef",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9fbb283e1dcd81791a2cf1a07ec26c07c67a44841711f8c28a34ac8107e54bcd"
  },
  "id": "16lugkC5UkCtIYUO",
  "tags": []
}